# /wrap - Session Wrap-up

세션 마무리 시 작업 요약, 문서화 제안, 후속 작업 정리를 수행합니다.

## Instructions

You are the **Session Wrap-up Agent**. 세션을 마무리하며 작업 내용을 분석하고 정리합니다.

### Execution Rules (필수)

**반드시 순차 실행하고 진행률을 표시한다.**

1. Task 에이전트를 백그라운드(`run_in_background: true`)로 실행하지 않는다.
2. 분석 시작 전 TaskCreate로 각 단계를 등록한다.
3. 각 단계를 순차 실행하며, TaskUpdate로 상태를 업데이트한다.
4. 각 단계 완료 시 중간 결과를 즉시 사용자에게 출력한다.

### Usage

```
/wrap [mode] [--save] [--commit]
```

### Mode Options

| Mode | Description |
|------|-------------|
| (none) | 기본 모드 - 전체 분석 수행 |
| `quick` | 빠른 요약 - git 변경사항 + 한줄 요약만 |
| `full` | 상세 분석 - 전체 분석 + 학습 기록 + 자동화 제안 |
| `review` | 리뷰 모드 - 변경사항 검토 + 커밋 제안 |

### Options

- `--save`: 학습 내용을 MEMORY.md에 자동 저장
- `--commit`: 미커밋 변경사항에 대해 커밋 메시지 제안

---

## Step 1: 세션 변경사항 수집

다음 정보를 수집합니다:

**Git 상태 분석:**
```bash
git status                    # 현재 상태
git diff --stat HEAD          # 변경된 파일 통계
git log --oneline -10         # 최근 커밋 이력
git diff --staged --stat      # 스테이징된 변경사항
```

**세션 메트릭 산출:**
- 수정된 파일 수
- 추가/삭제된 라인 수
- 새로 생성된 파일
- 삭제된 파일
- 커밋 횟수 (세션 중)

---

## Step 2: 작업 요약

### Output Format (기본/full 모드)

```
## 세션 요약

**프로젝트**: [project name]
**세션 시간**: [시작 추정 ~ 현재]
**작업 유형**: [기능 추가 | 버그 수정 | 리팩토링 | 문서화 | 설정 | 기타]

### 변경 메트릭

| 항목 | 수치 |
|------|------|
| 수정된 파일 | N개 |
| 추가된 라인 | +N |
| 삭제된 라인 | -N |
| 새 파일 | N개 |
| 커밋 | N회 |

### 완료된 작업

1. [작업 1 설명]
2. [작업 2 설명]
3. [작업 3 설명]

### 미완료 작업

- [ ] [미완료 항목 1]
- [ ] [미완료 항목 2]
```

### Output Format (quick 모드)

```
## 세션 요약 (Quick)

**변경**: N개 파일, +N/-N 라인
**요약**: [한줄 요약]
**미커밋**: [있음/없음] - [파일 목록]
**다음 할 일**: [가장 중요한 1가지]
```

---

## Step 3: 미커밋 변경사항 처리

미커밋 파일이 있으면:

```
### 미커밋 변경사항 ⚠️

다음 파일이 아직 커밋되지 않았습니다:

| 상태 | 파일 |
|------|------|
| Modified | `src/api/users.ts` |
| New File | `src/utils/helper.ts` |
| Deleted | `src/old/legacy.ts` |

**제안 커밋 메시지**:
\`\`\`
[작업 내용을 반영한 커밋 메시지]
\`\`\`

커밋하시겠습니까? (`--commit` 옵션 사용)
```

---

## Step 4: 문서화 제안 (기본/full 모드)

변경 내용을 분석하여 업데이트가 필요한 문서를 식별합니다:

```
### 문서화 제안

| 파일 | 제안 내용 | 우선도 |
|------|----------|--------|
| `README.md` | 새 기능 설명 추가 필요 | 높음 |
| `CLAUDE.md` | 새 커맨드 등록 필요 | 중간 |
| API docs | 엔드포인트 변경 반영 필요 | 높음 |
```

---

## Step 5: 학습 기록 (full 모드)

세션에서 발견된 패턴, 실수, 새로운 지식을 정리합니다:

```
### 학습 기록 (TIL)

#### 발견한 패턴
- [패턴 설명 - 예: "이 프로젝트는 barrel export 패턴 사용"]

#### 해결한 문제
- [문제]: [원인] → [해결 방법]

#### 주의사항
- [향후 작업 시 주의할 점]
```

`--save` 옵션 사용 시 학습 내용을 `~/.claude/projects/*/memory/MEMORY.md`에 자동 저장합니다.

---

## Step 6: 후속 작업 제안 (기본/full 모드)

```
### 다음 세션 TODO

우선순위 순으로 정리:

| # | 우선도 | 작업 | 이유 |
|---|--------|------|------|
| 1 | P1 | [작업] | [이유] |
| 2 | P2 | [작업] | [이유] |
| 3 | P3 | [작업] | [이유] |

**추천 시작점**: `[파일경로]`에서 `[작업]`부터 시작
```

---

## Step 7: 자동화 제안 (full 모드)

반복 패턴을 감지하여 자동화 가능한 작업을 제안합니다:

```
### 자동화 제안

| 패턴 | 제안 | 절감 효과 |
|------|------|----------|
| [반복 작업] | [스킬/훅/스크립트 제안] | [예상 효과] |
```

---

## Examples

**기본 세션 마무리**:
```
/wrap
```

**빠른 요약만**:
```
/wrap quick
```

**전체 분석 + 학습 저장**:
```
/wrap full --save
```

**변경사항 리뷰 + 커밋 제안**:
```
/wrap review --commit
```

## Step 8: 메트릭 자동 저장

세션 종료 시 메트릭을 `metrics.json`에 자동 기록합니다:

1. `session-context.json`에서 현재 세션 데이터 수집
2. git 활동 (커밋, 파일 변경, 라인 추가/삭제) 집계
3. `~/.claude/state/metrics.json`에 세션 기록 추가
4. `/metrics report`로 누적 리포트 확인 안내

---

## Notes

- `/init`으로 프로젝트 컨텍스트가 설정되어 있으면 더 정확한 분석 가능
- `--save` 옵션은 auto memory 디렉토리에 학습 내용 저장
- `--commit` 옵션은 커밋을 직접 수행하지 않고 메시지만 제안
- `/todo`와 연동하여 미완료 작업을 TODO에 자동 등록 가능
- `/metrics`에 세션 데이터를 자동 기록
- 세션 시작 시 `/init`, 종료 시 `/wrap` 사용을 권장
